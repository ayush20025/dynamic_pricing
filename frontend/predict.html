<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Pricing ‚Äì Prediction</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
    <div class="nav-container">
        <div class="logo">DynamicPrice AI</div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="predict.html" class="active">Prediction</a></li>
            <li><a href="analytics.html">Analytics</a></li>
            <li><a href="about.html">About</a></li>
        </ul>
    </div>
</nav>

<div class="container">
<div class="main-content">

<!-- HERO -->
<div class="hero">
    <h1>Price Prediction & Optimization</h1>
    <p>AI-powered pricing for single products and datasets</p>
</div>

<h3>üîç Single Product Prediction</h3>

<form id="predictionForm">
    <div class="form-grid">
        <div class="form-group">
            <label>Product Name</label>
            <input type="text" id="product" required>
        </div>

        <div class="form-group">
            <label>Category</label>
            <select id="category" required>
                <option value="">Select</option>
                <option>Electronics</option>
                <option>Clothing</option>
                <option>Home & Garden</option>
                <option>Sports</option>
                <option>Books</option>
                <option>Beauty</option>
            </select>
        </div>

        <div class="form-group">
            <label>Current Price (‚Çπ)</label>
            <input type="number" id="current_price" required>
        </div>

        <div class="form-group">
            <label>Competitor Price (‚Çπ)</label>
            <input type="number" id="competitor_price" required>
        </div>

        <div class="form-group">
            <label>Season</label>
            <select id="season" required>
                <option value="">Select</option>
                <option value="normal">Normal</option>
                <option value="holiday">Holiday</option>
            </select>
        </div>

        <div class="form-group">
            <label>Day Type</label>
            <select id="day" required>
                <option value="">Select</option>
                <option value="weekday">Weekday</option>
                <option value="weekend">Weekend</option>
            </select>
        </div>
    </div>

    <div style="text-align:center; margin-top:1.5rem;">
        <button type="submit" class="btn">Get Price Recommendation</button>
        <button type="button" class="btn btn-secondary" onclick="loadSample()">
            Load Sample Data
        </button>
    </div>
</form>

<div id="singleResult" class="results success-box" style="display:none;">
    <h3>üìä Price Optimization Results</h3>

    <div class="form-grid">
        <div class="card">
            <h4>üìâ Current Metrics</h4>
            <p>Current Price <span id="curPrice"></span></p>
            <p>Current Demand <span id="curDemand"></span></p>
            <p>Current Revenue <span id="curRevenue"></span></p>
        </div>

        <div class="card">
            <h4>üéØ Recommended Metrics</h4>
            <p>Recommended Price <span id="recPrice"></span></p>
            <p>Predicted Demand <span id="predDemand"></span></p>
            <p>Predicted Revenue <span id="predRevenue"></span></p>
        </div>
    </div>

    <div class="recommendation">
        üí∞ Revenue Increase: <strong id="revIncrease"></strong>
    </div>
</div>

<hr style="margin:3rem 0;">

<h3>üìÇ Dataset Price Analysis</h3>
<p>Upload a CSV file to analyze revenue growth across multiple products</p>

<input type="file" id="fileInput" accept=".csv">
<button class="btn" onclick="analyzeDataset()">Analyze Dataset</button>

<div id="loading" class="loading" style="display:none;">
    <div class="spinner"></div>
    Processing...
</div>

<div id="error" class="error" style="display:none;"></div>

<div id="datasetResults" class="results success-box" style="display:none;">
    <p id="avgCurrent"></p>
    <p id="avgOptimized"></p>
    <p id="growth"></p>

    <div class="chart-container">
        <canvas id="revenueChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="growthChart"></canvas>
    </div>
</div>

</div>
</div>

<!-- ================= API CONFIG (IMPORTANT) ================= -->
<script>
/* ‚úÖ Render Backend API URL */
const API_BASE = "https://dynamic-pricing-vbsw.onrender.com";
</script>

<!-- ================= SCRIPT ================= -->
<script>
let revenueChart, growthChart;

function loadSample() {
    product.value = "iPhone 15 Pro";
    category.value = "Electronics";
    current_price.value = 79999;
    competitor_price.value = 75000;
    season.value = "holiday";
    day.value = "weekend";
}

predictionForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const payload = {
        product: product.value,
        category: category.value,
        current_price: Number(current_price.value),
        competitor_price: Number(competitor_price.value),
        season: season.value,
        day: day.value
    };

    const res = await fetch(`${API_BASE}/predict`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    const d = await res.json();
    singleResult.style.display = "block";

    curPrice.innerText = "‚Çπ" + d.current_price.toFixed(2);
    curDemand.innerText = d.current_demand.toFixed(0) + " units";
    curRevenue.innerText = "‚Çπ" + d.current_revenue.toFixed(2);

    recPrice.innerText = "‚Çπ" + d.recommended_price.toFixed(2);
    predDemand.innerText = d.predicted_demand_at_recommended_price.toFixed(0) + " units";
    predRevenue.innerText = "‚Çπ" + d.predicted_revenue.toFixed(2);

    revIncrease.innerText = "‚Çπ" + d.revenue_increase.toFixed(2);
});

async function analyzeDataset() {
    const file = fileInput.files[0];
    if (!file) return alert("Upload CSV file");

    loading.style.display = "block";
    datasetResults.style.display = "none";
    error.style.display = "none";

    const fd = new FormData();
    fd.append("file", file);

    try {
        const res = await fetch(`${API_BASE}/predict-batch`, {
            method: "POST",
            body: fd
        });

        if (!res.ok) throw new Error(await res.text());
        const d = await res.json();

        loading.style.display = "none";
        datasetResults.style.display = "block";

        avgCurrent.innerText =
            "Average Current Revenue: ‚Çπ" + d.summary.avg_current_revenue.toFixed(2);
        avgOptimized.innerText =
            "Average Optimized Revenue: ‚Çπ" + d.summary.avg_optimized_revenue.toFixed(2);
        growth.innerHTML =
            "Estimated Growth: <strong style='color:#16a34a;'>"
            + d.summary.growth_percent.toFixed(2) + "%</strong>";

        const labels = d.rows.map(r => r.product);
        const cur = d.rows.map(r => r.current_revenue);
        const opt = d.rows.map(r => r.optimized_revenue);
        const gr = d.rows.map(r => r.growth_percent);

        if (revenueChart) revenueChart.destroy();
        revenueChart = new Chart(revenueChart = new Chart(
            document.getElementById("revenueChart"), {
            type: "bar",
            data: { labels, datasets: [
                { label: "Current Revenue", data: cur },
                { label: "Optimized Revenue", data: opt }
            ]}
        }));

        if (growthChart) growthChart.destroy();
        growthChart = new Chart(
            document.getElementById("growthChart"), {
            type: "line",
            data: { labels, datasets: [
                { label: "Growth %", data: gr, tension: 0.4 }
            ]}
        });

    } catch (err) {
        loading.style.display = "none";
        error.style.display = "block";
        error.innerText = err.message;
    }
}
</script>

</body>
</html>
